<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Vecchio Telefono – Calcolatrice</title>
<style>
  :root{
    --scocca:#444;
    --scocca-chiaro:#5a5a5a;
    --schermo:#dfe6e9;
    --schermo-testo:#111;
    --tasto:#666;
    --tasto-azione:#777;
    --tasto-oper:#8a8a8a;
    --tasto-eguale:#3b82f6;
  }
  *{box-sizing:border-box}
  body{
    background:#e6e6e6;
    min-height:100vh; margin:0;
    display:flex; align-items:center; justify-content:center;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  }
  .telefono{
    background: linear-gradient(180deg, var(--scocca), #383838);
    width: 260px; height: 520px;
    border-radius: 34px; padding: 20px 18px;
    box-shadow: 0 12px 28px rgba(0,0,0,.35), inset 0 2px 0 rgba(255,255,255,.06);
    display:flex; flex-direction:column; align-items:center;
  }
  .altoparlante{
    width:72px; height:8px; border-radius:8px;
    background: linear-gradient(180deg, #222, #111);
    box-shadow: inset 0 2px 3px rgba(0,0,0,.6);
    margin-bottom:10px;
  }
  .schermo{
    background: radial-gradient(120px 90px at 50% 30%, #eef3f5, var(--schermo));
    width: 90%; height: 140px; border-radius: 10px;
    padding: 12px; margin-bottom: 16px;
    box-shadow: inset 0 0 6px rgba(0,0,0,.55);
    color: var(--schermo-testo);
    display:flex; flex-direction:column; justify-content:space-between;
    overflow:hidden;
  }
  .statusbar{
    display:flex; align-items:center; justify-content:space-between; gap:8px;
    font-size:11px; opacity:.8;
  }
  .segnale span{display:inline-block;width:4px;height:8px;background:#333;margin-right:2px;border-radius:1px}
  .display{
    font-variant-numeric: tabular-nums;
    font-size: 24px; line-height:1.2; text-align:right; word-break: break-all;
  }
  .subdisplay{font-size:12px; opacity:.7; text-align:right; height:16px}

  .pannello-funzioni{
    display:grid; grid-template-columns: repeat(4, 1fr);
    gap:8px; width: 90%; margin-bottom:12px;
  }
  .tastiera{
    display:grid; grid-template-columns: repeat(3, 1fr);
    gap:8px; width: 90%; justify-content:center;
  }
  button.tasto{
    appearance:none; border:0; cursor:pointer;
    background: linear-gradient(180deg, var(--tasto), #585858);
    border-radius:8px; height:44px; color:#fff; font-size:16px; font-weight:600;
    box-shadow: inset 0 -3px 3px rgba(0,0,0,.35), 0 1px 0 rgba(255,255,255,.06);
    transition: transform .02s ease-in-out, filter .15s;
  }
  button.tasto:active{ transform: translateY(1px); filter:brightness(.95) }
  .tasto.oper{ background: linear-gradient(180deg, var(--tasto-oper), #707070); }
  .tasto.az{ background: linear-gradient(180deg, var(--tasto-azione), #6b6b6b); }
  .tasto.eq{ background: linear-gradient(180deg, var(--tasto-eguale), #1d4ed8); }

  .tastiera .tasto.zero{ grid-column: span 2; }

  .griglia{ display:flex; flex-direction:column; align-items:center; gap:10px; width:100%; }
  .microfono{
    margin-top:auto; width:58px; height:10px; border-radius:10px;
    background: linear-gradient(180deg, #2a2a2a, #171717);
    box-shadow: inset 0 2px 3px rgba(0,0,0,.65);
  }
  .firma{ margin-top:8px; font-size:10px; color:#cfcfcf; opacity:.7; }

  /* Accessibilità focus */
  .tasto:focus{ outline:2px solid #bcd7ff; outline-offset:2px; }
</style>
</head>
<body>
  <div class="telefono" role="application" aria-label="Calcolatrice in stile vecchio telefono">
    <div class="altoparlante" aria-hidden="true"></div>
    <div class="schermo" aria-live="polite">
      <div class="statusbar">
        <div class="segnale" aria-hidden="true">
          <span></span><span></span><span></span><span></span><span></span>
        </div>
        <div id="clock">--:--</div>
      </div>
      <div class="subdisplay" id="history" aria-hidden="true"></div>
      <div class="display" id="display">0</div>
    </div>

    <!-- Pannello funzioni: AC, C, backspace, divisione; percentuale; +/-; moltiplicazione -->
    <div class="pannello-funzioni" aria-label="Comandi calcolatrice">
      <button class="tasto az" data-action="ac" title="Azzera tutto (AC)">AC</button>
      <button class="tasto az" data-action="c" title="Cancella inserimento (C)">C</button>
      <button class="tasto az" data-action="back" title="Backspace">⌫</button>
      <button class="tasto oper" data-op="/" title="Diviso">÷</button>
      <button class="tasto az" data-action="percent" title="Percentuale">%</button>
      <button class="tasto az" data-action="sign" title="Cambia segno">±</button>
      <button class="tasto oper" data-op="*" title="Per">×</button>
      <button class="tasto oper" data-op="-" title="Meno">−</button>
    </div>

    <!-- Tastiera numerica e resto -->
    <div class="tastiera" aria-label="Tastiera numerica">
      <button class="tasto" data-num="7">7</button>
      <button class="tasto" data-num="8">8</button>
      <button class="tasto" data-num="9">9</button>
      <button class="tasto" data-num="4">4</button>
      <button class="tasto" data-num="5">5</button>
      <button class="tasto" data-num="6">6</button>
      <button class="tasto" data-num="1">1</button>
      <button class="tasto" data-num="2">2</button>
      <button class="tasto" data-num="3">3</button>
      <button class="tasto zero" data-num="0">0</button>
      <button class="tasto" data-dot=".">,</button>
      <button class="tasto oper" data-op="+" title="Più">+</button>
      <button class="tasto eq" data-eq="=">=</button>
    </div>

    <div class="microfono" aria-hidden="true"></div>
    <div class="firma" aria-hidden="true">Loden Ipsum ©</div>
  </div>

<script>
(function(){
  const display = document.getElementById('display');
  const history = document.getElementById('history');

  let prev = null;        // numero precedente
  let cur = '0';          // numero corrente come stringa
  let op = null;          // operatore corrente (+ - * /)
  let overwrite = true;   // se true, il prossimo numero sostituisce cur

  function format(n){
    // Gestione numeri molto lunghi e locale semplice
    const asNum = Number(n);
    if (!Number.isFinite(asNum)) return 'Errore';
    const s = asNum.toString();
    if (s.length > 12) return asNum.toExponential(6);
    return asNum.toLocaleString('it-IT');
  }

  function updateDisplay(){
    display.textContent = format(cur);
    let hist = '';
    if (prev !== null && op){ hist = `${format(prev)} ${symbol(op)}`; }
    history.textContent = hist;
  }

  function symbol(o){ return ({'*':'×','/':'÷','+':'＋','-':'−'})[o] || o; }

  function inputDigit(d){
    if (overwrite){ cur = d; overwrite = false; }
    else cur = (cur === '0') ? d : (cur + d);
    updateDisplay();
  }

  function inputDot(){
    if (overwrite){ cur = '0.'; overwrite = false; }
    else if (!cur.includes('.')) cur += '.';
    updateDisplay();
  }

  function setOperator(nextOp){
    if (op && !overwrite){ // se c'è un'operazione pendente, calcola prima
      compute();
    } else {
      prev = Number(cur);
    }
    op = nextOp;
    overwrite = true;
    updateDisplay();
  }

  function compute(){
    if (op === null || prev === null) return;
    const a = prev;
    const b = Number(cur);
    let res;
    switch(op){
      case '+': res = a + b; break;
      case '-': res = a - b; break;
      case '*': res = a * b; break;
      case '/': res = (b === 0) ? Infinity : a / b; break;
      default: return;
    }
    cur = String(res);
    prev = null; op = null; overwrite = true;
    updateDisplay();
  }

  function clearEntry(){ cur = '0'; overwrite = true; updateDisplay(); }
  function allClear(){ prev = null; cur = '0'; op = null; overwrite = true; updateDisplay(); }
  function backspace(){ if (!overwrite){ cur = cur.length>1 ? cur.slice(0,-1) : '0'; updateDisplay(); } }
  function toggleSign(){ if (cur !== '0'){ cur = String(Number(cur) * -1); updateDisplay(); } }
  function percent(){ cur = String(Number(cur) / 100); updateDisplay(); }

  // Click handling
  document.addEventListener('click', (e)=>{
    const btn = e.target.closest('button.tasto');
    if (!btn) return;
    const d = btn.dataset;
    if (d.num) return inputDigit(d.num);
    if (d.dot!==undefined) return inputDot();
    if (d.op) return setOperator(d.op);
    if (d.eq!==undefined) return compute();
    if (d.action === 'c') return clearEntry();
    if (d.action === 'ac') return allClear();
    if (d.action === 'back') return backspace();
    if (d.action === 'sign') return toggleSign();
    if (d.action === 'percent') return percent();
  });

  // Keyboard support
  document.addEventListener('keydown', (e)=>{
    const k = e.key;
    if (/^[0-9]$/.test(k)) return inputDigit(k);
    if (k === ',' || k === '.') return inputDot();
    if (k === '+' || k === '-' || k === '*' || k === '/') return setOperator(k);
    if (k === 'Enter' || k === '=') return compute();
    if (k === 'Backspace') return backspace();
    if (k.toLowerCase()==='c') return clearEntry();
    if (k.toLowerCase()==='a') return allClear();
    if (k === '%') return percent();
  });

  // mini orologio stile feature phone
  function tick(){
    const now = new Date();
    const hh = String(now.getHours()).padStart(2,'0');
    const mm = String(now.getMinutes()).padStart(2,'0');
    document.getElementById('clock').textContent = `${hh}:${mm}`;
  }
  tick(); setInterval(tick, 10_000);

  updateDisplay();
})();
</script>
</body>
</html>