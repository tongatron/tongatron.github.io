<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La tua linea del tempo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 900px;
        }
        .header-section {
            background-color: #0d6efd;
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            border-radius: 0.5rem;
        }
        .table-container {
            margin-top: 2rem;
            overflow-x: auto;
        }
        .lifetime-table td {
            width: 25px;
            height: 25px;
            padding: 0;
            border: 1px solid #dee2e6;
            text-align: center;
            vertical-align: middle;
            font-weight: bold;
        }
        .past-cell {
            background-color: #e9ecef; /* Sfondo grigio chiaro per la cella */
            color: #28a745; /* Verde per le 'X' */
        }
        .chart-container {
            margin-top: 3rem;
        }
    </style>
</head>
<body>
    <div class="container text-center">
        <header class="header-section">
            <h1 class="display-4">La tua linea del tempo</h1>
            <p class="lead">Inserisci il tuo mese e anno di nascita per visualizzare la tua vita in una griglia di mesi.</p>
        </header>

        <main>
            <div class="card p-4 shadow-sm">
                <h2 class="card-title">Inserisci la tua data di nascita</h2>
                <form id="birthForm" class="row g-3 justify-content-center mt-3">
                    <div class="col-md-4">
                        <label for="birthMonth" class="form-label">Mese di nascita:</label>
                        <select id="birthMonth" class="form-select" required>
                            <option value="" disabled selected>Seleziona mese</option>
                            <option value="1">Gennaio</option>
                            <option value="2">Febbraio</option>
                            <option value="3">Marzo</option>
                            <option value="4">Aprile</option>
                            <option value="5">Maggio</option>
                            <option value="6">Giugno</option>
                            <option value="7">Luglio</option>
                            <option value="8">Agosto</option>
                            <option value="9">Settembre</option>
                            <option value="10">Ottobre</option>
                            <option value="11">Novembre</option>
                            <option value="12">Dicembre</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="birthYear" class="form-label">Anno di nascita:</label>
                        <input type="number" id="birthYear" class="form-control" min="1900" max="2025" required>
                    </div>
                    <div class="col-12 mt-4">
                        <button type="submit" class="btn btn-primary btn-lg">Genera tabella e grafico</button>
                    </div>
                </form>

                <div id="table-container" class="table-container d-none">
                    <h3>La tua linea del tempo (aspettativa di vita: 85 anni)</h3>
                    <div id="lifetime-table-wrapper"></div>
                </div>

                <div id="chart-container" class="chart-container d-none">
                    <h3>Mesi trascorsi rispetto all'aspettativa di vita</h3>
                    <div class="d-flex justify-content-center">
                        <canvas id="lifetimeChart" style="max-width: 400px;"></canvas>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        document.getElementById('birthForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const birthMonth = parseInt(document.getElementById('birthMonth').value);
            const birthYear = parseInt(document.getElementById('birthYear').value);
            const tableContainer = document.getElementById('table-container');
            const tableWrapper = document.getElementById('lifetime-table-wrapper');
            const chartContainer = document.getElementById('chart-container');
            const lifeExpectancy = 85;

            // Logica per calcolare i mesi trascorsi
            const today = new Date();
            const currentYear = today.getFullYear();
            const currentMonth = today.getMonth() + 1; // getMonth() restituisce 0-11

            let monthsPassed = 0;
            if (currentYear === birthYear) {
                monthsPassed = currentMonth - birthMonth;
            } else {
                const monthsInBirthYear = 12 - birthMonth + 1;
                const monthsInCurrentYear = currentMonth;
                const yearsInBetween = currentYear - birthYear - 1;
                const monthsInBetween = yearsInBetween * 12;
                monthsPassed = monthsInBirthYear + monthsInBetween + monthsInCurrentYear;
            }

            // Generazione della tabella
            let tableHTML = '<table class="table table-bordered lifetime-table">';
            tableHTML += '<thead><tr><th>Anno</th>';
            const months = ['Gen', 'Feb', 'Mar', 'Apr', 'Mag', 'Giu', 'Lug', 'Ago', 'Set', 'Ott', 'Nov', 'Dic'];
            months.forEach(month => {
                tableHTML += `<th scope="col">${month}</th>`;
            });
            tableHTML += '</tr></thead><tbody>';

            let cellCounter = 0;
            for (let year = birthYear; year < birthYear + lifeExpectancy; year++) {
                tableHTML += `<tr><th scope="row">${year}</th>`;
                for (let month = 1; month <= 12; month++) {
                    let cellContent = '';
                    let cellClass = '';
                    if (cellCounter < monthsPassed) {
                        cellContent = 'X';
                        cellClass = 'class="past-cell"';
                    }
                    tableHTML += `<td ${cellClass}>${cellContent}</td>`;
                    cellCounter++;
                }
                tableHTML += '</tr>';
            }
            tableHTML += '</tbody></table>';

            tableWrapper.innerHTML = tableHTML;
            tableContainer.classList.remove('d-none');

            // Logica per il grafico a torta
            const totalMonths = lifeExpectancy * 12;
            const monthsRemaining = totalMonths - monthsPassed;

            const ctx = document.getElementById('lifetimeChart').getContext('2d');
            
            // Per evitare errori se il grafico viene generato pi√π volte
            if (window.myChart instanceof Chart) {
                window.myChart.destroy();
            }

            window.myChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Mesi Trascorsi', 'Mesi Rimanenti'],
                    datasets: [{
                        data: [monthsPassed, monthsRemaining],
                        backgroundColor: [
                            '#28a745', // Verde per i mesi passati nel grafico
                            '#e9ecef'  // Grigio chiaro per i mesi rimanenti
                        ],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += context.parsed.toFixed(0) + ' mesi';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            chartContainer.classList.remove('d-none');
        });
    </script>
</body>
</html>