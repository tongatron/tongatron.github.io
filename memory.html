<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Memory Multi-Giocatore Migliorato</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body {margin:0; font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",sans-serif; background:#f2f2f7; color:#111;}
.wrapper {display:flex; min-height:100vh;}
.sidebar {width:260px; background:#fff; border-right:1px solid #ccc; padding:20px; box-shadow:1px 0 8px rgba(0,0,0,0.05);}
.sidebar h5,h6{font-weight:600;margin-bottom:8px;}
.sidebar small{color:#666;}
.main {flex:1; text-align:center; padding:30px 20px;}
h1{font-weight:600;letter-spacing:-0.5px;margin-bottom:8px;}
.grid {display:grid; gap:12px; justify-content:center; margin-top:30px;}
.card {perspective:700px; cursor:pointer; position:relative;}
.inner {position:relative; width:76px; height:76px; transform-style:preserve-3d; transition:transform 0.45s cubic-bezier(.4,.2,.2,1);}
.card.flipped .inner {transform:rotateY(180deg);}
.face {position:absolute; width:100%; height:100%; border-radius:12px; background:#eee; border:1px solid #ddd; display:flex; align-items:center; justify-content:center; font-size:24px; backface-visibility:hidden; box-shadow:0 3px 6px rgba(0,0,0,0.08);}
.front {background:linear-gradient(#f8f8f8,#eaeaea);}
.back {transform:rotateY(180deg); font-size:28px; background:#fffbe6; border:1px solid #f0dca0;}
.box {margin-top:12px; padding:12px; border-radius:12px; background:#fff; border:1px solid #ddd; font-size:14px; box-shadow:0 2px 6px rgba(0,0,0,0.05);}
.btn-apple {background:#007aff; border:none; color:#fff; border-radius:999px; padding:6px 14px; font-weight:500;}
.btn-apple:hover {background:#0062d6;}
.btn-ghost {border-radius:999px; border:1px solid #ccc; background:transparent; color:#666;}
.btn-ghost:hover {background: rgba(0,0,0,0.04); color:#111;}
input.form-control{border-radius:12px; border:1px solid #ccc; padding:6px 10px;}

/* Animazione vittoria */
@keyframes winBounce {
  0% { transform: scale(1); }
  25% { transform: scale(1.1); }
  50% { transform: scale(0.95); }
  75% { transform: scale(1.05); }
  100% { transform: scale(1); }
}
.card.winner .inner {animation: winBounce 0.8s ease-in-out 3; border:2px solid #007aff;}

/* Carte abbinate evidenziate */
.card.matched .back { background:#d0f0fd; border-color:#007aff; }

/* Nascondi i box dei risultati su mobile */
@media (max-width: 768px) {
  #playerStatsBox,
  #recordBox,
  #statusBox {
    display: none;
  }
}
</style>
</head>
<body>

<div class="wrapper">
<div class="sidebar">
  <h5>Login</h5>
  <input id="playerName" class="form-control mb-2" placeholder="Inserisci nome">
  <button class="btn btn-apple mb-3" onclick="loginPlayer()">Accedi</button>

  <hr>

  <h6>Dimensione</h6>
  <label><input type="radio" name="size" value="4" checked> 4√ó4</label><br>
  <label><input type="radio" name="size" value="6"> 6√ó6</label><br>
  <label><input type="radio" name="size" value="7"> 7√ó7</label>

  <div class="mt-3 d-grid gap-2">
    <button class="btn btn-apple" onclick="init()">Nuova partita</button>
    <button class="btn btn-ghost" onclick="resetRecord()">Reset record</button>
  </div>

  <div class="box" id="statusBox">Nessun giocatore loggato</div>
  <div class="box" id="recordBox">Record: -</div>
  <div class="box" id="playerStatsBox">Seleziona un giocatore</div>
</div>

<div class="main">
  <h1>Memory</h1>
  Mosse: <b id="moves">0</b>
  <div class="grid" id="grid"></div>
</div>
</div>

<script>
const symbols=["üçï","üöÄ","üê±","üé∏","üç∫","üëæ","üî•","‚öΩ","üé≤","üß†","üíÄ","üéß","üåà","ü¶ä","üõ∏","ü•Å"];
let size=4,cards=[],first=null,second=null,lock=false,moves=0;
let currentPlayer=null;

const grid=document.getElementById("grid");
const movesEl=document.getElementById("moves");
const statusBox=document.getElementById("statusBox");
const playerStatsBox=document.getElementById("playerStatsBox");
const recordBox=document.getElementById("recordBox");

// Login
function loginPlayer(){
  const name=document.getElementById("playerName").value.trim();
  if(!name) return alert("Inserisci un nome!");
  currentPlayer=name;
  if(!localStorage.getItem("players")) localStorage.setItem("players",JSON.stringify({}));
  const players=JSON.parse(localStorage.getItem("players"));
  if(!players[currentPlayer]) players[currentPlayer]={};
  localStorage.setItem("players",JSON.stringify(players));
  statusBox.innerHTML=`Giocatore attivo: <b>${currentPlayer}</b>`;
  updatePlayerStats();
  init();
}

// Inizializza gioco
function init(){
  if(!currentPlayer){ alert("Fai login!"); return; }
  size=parseInt(document.querySelector("input[name=size]:checked").value);
  const total=size*size;
  const pairs=Math.floor(total/2);
  moves=0; movesEl.textContent=0;
  first=second=null; lock=false;
  grid.innerHTML="";
  const selected=shuffle(symbols).slice(0,pairs);
  cards=shuffle([...selected,...selected]);
  grid.style.gridTemplateColumns=`repeat(${size},76px)`;
  cards.forEach(s=>{
    const c=document.createElement("div");
    c.className="card"; c.dataset.symbol=s;
    c.innerHTML=`<div class="inner"><div class="face front"></div><div class="face back">${s}</div></div>`;
    c.onclick=flip;
    grid.appendChild(c);
  });
}

// Flip
function flip(){
  if(lock||this.classList.contains("flipped")||this.classList.contains("matched")) return;
  this.classList.add("flipped");
  if(!first){first=this; return;}
  second=this;
  moves++; movesEl.textContent=moves;
  if(first.dataset.symbol===second.dataset.symbol){
    first.classList.add("matched");
    second.classList.add("matched");
    first=second=null; checkWin();
  } else {
    lock=true;
    setTimeout(()=>{
      first.classList.remove("flipped");
      second.classList.remove("flipped");
      first=second=null;
      lock=false;
    },700);
  }
}

// Vittoria
function checkWin(){
  if(document.querySelectorAll(".matched").length===cards.length){
    saveStats();
    saveRecord();
    updatePlayerStats();
    animateWin();
    setTimeout(()=>alert(`Vinto in ${moves} mosse!`), 500);
  }
}

// Animazione vittoria
function animateWin(){
  document.querySelectorAll(".card").forEach(c=>{
    c.classList.add("winner");
    setTimeout(()=>c.classList.remove("winner"), 2400);
  });
}

// LocalStorage multi-giocatore e per matrice
function saveRecord(){
  const players=JSON.parse(localStorage.getItem("players"));
  const dim=size+"x"+size;
  players[currentPlayer] = players[currentPlayer] || {};
  players[currentPlayer][dim] = players[currentPlayer][dim] || {};
  if(!players[currentPlayer][dim].record || moves < players[currentPlayer][dim].record){
    players[currentPlayer][dim].record = moves;
    players[currentPlayer][dim].last_play = new Date().toLocaleString();
  }
  localStorage.setItem("players",JSON.stringify(players));
}

function saveStats(){
  const players=JSON.parse(localStorage.getItem("players"));
  const dim=size+"x"+size;
  players[currentPlayer][dim]=players[currentPlayer][dim]||{};
  players[currentPlayer][dim].partite=(players[currentPlayer][dim].partite||0)+1;
  localStorage.setItem("players",JSON.stringify(players));
}

function resetRecord(){
  const players=JSON.parse(localStorage.getItem("players"));
  const dim=size+"x"+size;
  if(players[currentPlayer]) delete players[currentPlayer][dim];
  localStorage.setItem("players",JSON.stringify(players));
  updatePlayerStats();
}

// Aggiorna box record e partite
function updatePlayerStats(){
  const players=JSON.parse(localStorage.getItem("players"));
  const dim=size+"x"+size;
  if(players[currentPlayer] && players[currentPlayer][dim]){
    const p=players[currentPlayer][dim];
    playerStatsBox.innerHTML=`
      <b>${currentPlayer}</b><br>
      Dimensione: ${dim}<br>
      Record: ${p.record || "-"} mosse<br>
      Partite giocate: ${p.partite || 0}<br>
      Ultima partita: ${p.last_play || "-"}
    `;
  } else {
    playerStatsBox.innerHTML=`
      <b>${currentPlayer}</b><br>
      Dimensione: ${dim}<br>
      Nessun record ancora
    `;
  }
}

function shuffle(a){return a.sort(()=>Math.random()-0.5);}
</script>
</body>
</html>
