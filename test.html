<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>MidJourney prompt generator</title>

  <!-- Bootstrap-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

  <!-- Bootstrap icons-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- Personal stylesheet-->
  <link rel="stylesheet" href="tngstyle.css">

  <!-- Google fonts-->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">

  <style>
    .list-group-item {
      cursor: pointer;
    }
    .highlight {
      background-color: yellow;
    }
  </style>
</head>
<body>

<div class="container-mj">

  <!-- Input-->
  <div class="container">
    <br>
    <h3>Input</h3>
    <br>
    <div class="row row-cols-1 row-cols-md-3 g-4">
      <div class="col">
        <label for="subjects"><h5>SOGGETTI</h5></label>
        <div class="dropdown mb-2">
          <button class="btn btn-light btn-outline-dark btn-sm" type="button" id="dropdownMenuButtonSubjects" data-bs-toggle="dropdown" aria-expanded="false">
            seleziona presets
          </button>
          <ul class="dropdown-menu" aria-labelledby="dropdownMenuButtonSubjects" id="subjects-presets">
            <!-- Presets will be loaded here -->
          </ul>
        </div>
        <textarea class="form-control" id="subjects" placeholder="incolla o scrivi" rows="5"></textarea>
      </div>

      <div class="col">
        <label for="styles"><h5>STILI</h5></label>
        <div class="dropdown mb-2">
          <button class="btn btn-light btn-outline-dark btn-sm" type="button" id="dropdownMenuButtonStyles" data-bs-toggle="dropdown" aria-expanded="false">
            seleziona presets
          </button>
          <ul class="dropdown-menu" aria-labelledby="dropdownMenuButtonStyles" id="styles-presets">
            <!-- Presets will be loaded here -->
          </ul>
        </div>
        <textarea class="form-control" id="styles" placeholder="incolla o scrivi" rows="5"></textarea>
      </div>

      <div class="col">
        <label for="others"><h5>ALTRO</h5></label>
        <div class="dropdown mb-2">
          <button class="btn btn-light btn-outline-dark btn-sm" type="button" id="dropdownMenuButtonOthers" data-bs-toggle="dropdown" aria-expanded="false">
            seleziona presets
          </button>
          <ul class="dropdown-menu" aria-labelledby="dropdownMenuButtonOthers" id="others-presets">
            <!-- Presets will be loaded here -->
          </ul>
        </div>
        <textarea class="form-control" id="others" placeholder="incolla o scrivi" rows="5"></textarea>
      </div>
    </div>
  </div>

  <!-- Buttons -->
  <div class="container">
    <br>
    <div class="row justify-content-md-center">
      <div class="col col-md-4">
        <br>
        <button class="btn btn-warning btn-lg" onclick="generatePrompts()">Genera elenco dei prompt</button>
      </div>
      <div class="col col-md-4">
        <br>
        <button class="btn btn-danger btn-lg" onclick="clearInputs()">Cancella tutto</button>
      </div>
    </div>
  </div>

  <!-- Risultati -->
  <div class="container" id="results-container" style="display: none;">
    <div class="row">
      <p>
        <label for="results"><h3>Risultato</h3></label>
      </p>
      <p>Clicca su una riga per copiarne il contenuto negli appunti</p>
      <div class="col">
        <div id="results" class="list-group"></div>
        <br>
      </div>

      <div class="col">
        <p>
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-filetype-txt" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M14 4.5V14a2 2 0 0 1-2 2h-2v-1h2a1 1 0 0 0 1-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5zM1.928 15.849v-3.337h1.136v-.662H0v.662h1.134v3.337zm4.689-3.999h-.894L4.9 13.289h-.035l-.832-1.439h-.932l1.228 1.983-1.24 2.016h.862l.853-1.415h.035l.85 1.415h.907l-1.253-1.992zm1.93.662v3.337h-.794v-3.337H6.619v-.662h3.064v.662H8.546Z"/>
          </svg>
          <a href="#" onclick="copyAllToClipboard()">copia negli appunti</a>
          <span id="copy-notification" style="display: none; color: green; margin-left: 10px;">copiato</span>
          <br><br>
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-copy" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1z"/>
          </svg>
          <a href="#" onclick="downloadAsTxt()">scarica il file txt</a>
        </p>
        <p id="line-copy-notification" style="display: none; color: green; margin-top: 10px;">copiato negli appunti</p>
      </div>

    </div>
  </div>

</div>

<script>
    
let presets = {};

// Carica i presets dal file JSON
fetch('presets.json')
  .then(response => response.json())
  .then(data => {
    presets = data;
    populatePresets();
  })
  .catch(error => console.error('Errore nel caricamento dei presets:', error));

function populatePresets() {
  const subjectsPresets = document.getElementById('subjects-presets');
  const stylesPresets = document.getElementById('styles-presets');
  const othersPresets = document.getElementById('others-presets');

  for (const key in presets) {
    if (presets.hasOwnProperty(key)) {
      const li = document.createElement('li');
      li.innerHTML = `<a class="dropdown-item" href="#" onclick="loadPreset('${key}')">${key}</a>`;
      
      if (key === 'Animali' || key === 'Realismo') {
        subjectsPresets.appendChild(li);
      } else if (key === 'Fotografia' || key === 'Pittura') {
        stylesPresets.appendChild(li);
      } else {
        othersPresets.appendChild(li);
      }
    }
  }
}

function loadPreset(preset) {
  if (presets[preset]) {
    let targetId;
    if (preset === 'Animali' || preset === 'Realismo') {
      targetId = 'subjects';
    } else if (preset === 'Fotografia' || preset === 'Pittura') {
      targetId = 'styles';
    } else {
      targetId = 'others';
    }
    document.getElementById(targetId).value = presets[preset].join('\n');
  }
}

  function generatePrompts() {
    const subjects = document.getElementById('subjects').value.split('\n').map(item => item.trim()).filter(item => item);
    const styles = document.getElementById('styles').value.split('\n').map(item => item.trim()).filter(item => item);
    const others = document.getElementById('others').value.split('\n').map(item => item.trim()).filter(item => item);

    let prompts = [];
    
    if (styles.length === 0) styles.push(''); // Aggiungi elemento vuoto se array vuoto
    if (subjects.length === 0) subjects.push(''); // Aggiungi elemento vuoto se array vuoto
    if (others.length === 0) others.push(''); // Aggiungi elemento vuoto se array vuoto

    styles.forEach(style => {
      subjects.forEach(subject => {
        others.forEach(other => {
          prompts.push(`${style} ${subject} ${other}`.trim());
        });
      });
    });

    const resultsContainer = document.getElementById('results-container');
    const results = document.getElementById('results');
    results.innerHTML = '';

    if (prompts.length > 0) {
      prompts.forEach(prompt => {
        const item = document.createElement('a');
        item.className = 'list-group-item list-group-item-action result-item';
        item.textContent = prompt;
        item.onclick = () => copyLineToClipboard(prompt);
        results.appendChild(item);
      });
      resultsContainer.style.display = 'block';
    } else {
      resultsContainer.style.display = 'none';
    }
  }

  function clearInputs() {
    document.getElementById('subjects').value = '';
    document.getElementById('styles').value = '';
    document.getElementById('others').value = '';
    document.getElementById('results').innerHTML = '';
    document.getElementById('results-container').style.display = 'none';
  }

  function copyLineToClipboard(line) {
    const tempInput = document.createElement('textarea');
    tempInput.style.position = 'absolute';
    tempInput.style.left = '-9999px';
    tempInput.value = line;
    document.body.appendChild(tempInput);
    tempInput.select();
    document.execCommand('copy');
    document.body.removeChild(tempInput);

    // Mostra la notifica "copiato negli appunti"
    const lineCopyNotification = document.getElementById('line-copy-notification');
    lineCopyNotification.style.display = 'block';

    // Nascondi la notifica dopo 2 secondi
    setTimeout(() => {
      lineCopyNotification.style.display = 'none';
    }, 2000);

    // Evidenzia la riga cliccata
    const resultItems = document.querySelectorAll('.result-item');
    resultItems.forEach(item => {
      if (item.textContent === line) {
        item.classList.add('highlight');
        setTimeout(() => {
          item.classList.remove('highlight');
        }, 2000);
      }
    });
  }

  function copyAllToClipboard() {
    const results = Array.from(document.getElementById('results').children)
      .map(item => item.textContent)
      .join('\n');
    const tempInput = document.createElement('textarea');
    tempInput.style.position = 'absolute';
    tempInput.style.left = '-9999px';
    tempInput.value = results;
    document.body.appendChild(tempInput);
    tempInput.select();
    document.execCommand('copy');
    document.body.removeChild(tempInput);

    // Mostra la notifica "copiato"
    const copyNotification = document.getElementById('copy-notification');
    copyNotification.style.display = 'inline';

    // Nascondi la notifica dopo 2 secondi
    setTimeout(() => {
      copyNotification.style.display = 'none';
    }, 2000);
  }

  function downloadAsTxt() {
    const results = Array.from(document.getElementById('results').children)
      .map(item => item.textContent)
      .join('\n');
    const blob = new Blob([results], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'prompts.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
  }
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>

</body>
</html>
