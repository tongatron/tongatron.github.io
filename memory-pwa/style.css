:root{
  --gap:16px;
  --card-size:80px;
  --bg-a:#d7e8ff;
  --bg-b:#f6fbff;
  --bg-c:#e8f4ea;
}

html,body{
  height:100%;
  margin:0;
  overflow:hidden;
  font-family:-apple-system;
  background:
    radial-gradient(1200px 600px at 0% 0%,rgba(255,255,255,.6),transparent 70%),
    radial-gradient(900px 500px at 100% 100%,rgba(198,237,255,.55),transparent 70%),
    linear-gradient(145deg,var(--bg-a) 0%,var(--bg-b) 55%,var(--bg-c) 100%);
}

body{display:flex;flex-direction:column}

header{
  position:relative;
  text-align:center;
  padding:14px 10px 6px
}

.topVersion{
  position:absolute;
  top:6px;
  right:10px;
  font-family:"Courier New", monospace;
  font-size:11px;
  color:#555;
}

h1{margin:0;font-size:1.8rem}
#moves,#timer{color:#666;margin-top:2px}

main{
  flex:1;
  display:flex;
  justify-content:center;
  align-items:center;
  overflow:hidden
}

.grid{display:grid;gap:var(--gap)}

.card{
  width:var(--card-size);
  aspect-ratio:1;
  perspective:800px;
  cursor:pointer;
  opacity:0;
  transform:translateY(10px) scale(.98);
  animation:cardIn .45s ease-out forwards;
  animation-delay:calc(var(--i) * 20ms);
}

.inner{
  width:100%;
  height:100%;
  transform-style:preserve-3d;
  transition:transform .5s cubic-bezier(.22,.61,.36,1);
  position:relative
}

.card.flipped .inner{transform:rotateY(180deg)}

.face{
  position:absolute;
  inset:0;
  border-radius:14px;
  background:
    radial-gradient(120px 80px at 20% 15%,rgba(255,255,255,.95),rgba(255,255,255,.55) 50%,transparent 80%),
    linear-gradient(150deg,#fefefe 0%,#f1f5fb 60%,#e6eef9 100%);
  border:1px solid rgba(70,98,132,.16);
  display:flex;
  align-items:center;
  justify-content:center;
  backface-visibility:hidden;
  box-shadow:0 8px 18px rgba(32,58,82,.16)
}

.back{
  transform:rotateY(180deg);
  font-size:clamp(26px,5vw,48px);
  background:
    radial-gradient(90px 70px at 78% 22%,rgba(255,255,255,.4),transparent 70%),
    linear-gradient(150deg,#dff4ff 0%,#c3e8ff 45%,#b5e1ff 100%);
  border-color:rgba(24,108,165,.25);
}

footer{
  background:#fff;
  border-top:1px solid #ddd;
  padding:10px;
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:8px;
  position:relative;
}

.version{
  position:absolute;
  right:10px;
  bottom:6px;
  font-size:12px;
  color:#666;
}

button{
  border:none;
  background:#e9e9ef;
  border-radius:18px;
  padding:8px 12px;
  font-weight:600;
  cursor:pointer
}

button#newGameBtn{
  background:#007aff;
  color:white;
}

button:active{transform:scale(.95)}

#matrixSelect{
  border:none;
  background:#e9e9ef;
  border-radius:18px;
  padding:8px 12px;
  font-weight:600;
  cursor:pointer;
  min-width:86px;
}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.35);
  display:none;
  align-items:center;
  justify-content:center
}

.box{
  background:white;
  border-radius:16px;
  padding:18px;
  width:min(90vw,360px);
  text-align:center
}

.actions{
  display:flex;
  justify-content:space-between;
  margin-top:10px
}

.recordRow{
  display:flex;
  justify-content:space-between;
  gap:10px;
  padding:6px 0;
  border-bottom:1px solid #f0f0f0;
}

.recordRow:last-child{border-bottom:none}

#updateBtn{
  display:none;
  position:fixed;
  bottom:70px;
  right:20px;
  padding:10px 14px;
  background:#ff9800;
  color:white;
  border:none;
  border-radius:6px;
  font-size:14px;
  z-index:9999;
  box-shadow:0 2px 8px rgba(0,0,0,.3);
}

.celebration{
  position:fixed;
  inset:0;
  opacity:0;
  pointer-events:none;
  transition:opacity .25s ease;
  z-index:9998;
}

.celebration.show{opacity:1}

.resultPopup{
  position:absolute;
  left:50%;
  bottom:96px;
  transform:translateX(-50%);
  min-width:min(86vw,320px);
  background:rgba(255,255,255,.95);
  border-radius:14px;
  padding:12px 14px;
  text-align:center;
  color:#1f1f1f;
  box-shadow:0 10px 26px rgba(0,0,0,.2);
  backdrop-filter:blur(2px);
}

.resultBadge{
  margin-top:8px;
  font-weight:700;
  color:#0f8a32;
  display:none;
}

.resultBadge.show{display:block}

.confettiLayer{
  position:absolute;
  inset:0;
  overflow:hidden;
}

.confettiPiece{
  position:absolute;
  top:-12vh;
  width:10px;
  height:16px;
  border-radius:2px;
  opacity:.9;
  animation:fall var(--dur) cubic-bezier(.2,.6,.2,1) forwards;
  animation-delay:var(--delay);
  will-change:transform;
}

@keyframes fall{
  from{transform:translate3d(0,0,0) rotate(0deg)}
  to{transform:translate3d(var(--dx),120vh,0) rotate(var(--spin))}
}

@keyframes cardIn{
  from{opacity:0;transform:translateY(10px) scale(.98)}
  to{opacity:1;transform:translateY(0) scale(1)}
}
